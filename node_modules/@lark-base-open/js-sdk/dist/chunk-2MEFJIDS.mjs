var Ye=typeof global=="object"&&global&&global.Object===Object&&global,H=Ye;var Xe=typeof self=="object"&&self&&self.Object===Object&&self,Qe=H||Xe||Function("return this")(),x=Qe;var et=x.Symbol,i=et;var P=Object.prototype,tt=P.hasOwnProperty,rt=P.toString,v=i?i.toStringTag:void 0;function at(e){var t=tt.call(e,v),r=e[v];try{e[v]=void 0;var a=!0}catch(s){}var o=rt.call(e);return a&&(t?e[v]=r:delete e[v]),o}var j=at;var ot=Object.prototype,st=ot.toString;function ft(e){return st.call(e)}var L=ft;var it="[object Null]",nt="[object Undefined]",N=i?i.toStringTag:void 0;function ut(e){return e==null?e===void 0?nt:it:N&&N in Object(e)?j(e):L(e)}var f=ut;function dt(e){return e!=null&&typeof e=="object"}var d=dt;var lt="[object Symbol]";function pt(e){return typeof e=="symbol"||d(e)&&f(e)==lt}var c=pt;function mt(e,t){for(var r=-1,a=e==null?0:e.length,o=Array(a);++r<a;)o[r]=t(e[r],r,e);return o}var D=mt;var ht=Array.isArray,n=ht;var xt=1/0,W=i?i.prototype:void 0,z=W?W.toString:void 0;function U(e){if(typeof e=="string")return e;if(n(e))return D(e,U)+"";if(c(e))return z?z.call(e):"";var t=e+"";return t=="0"&&1/e==-xt?"-0":t}var B=U;function ct(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var k=ct;var gt="[object AsyncFunction]",yt="[object Function]",bt="[object GeneratorFunction]",_t="[object Proxy]";function vt(e){if(!k(e))return!1;var t=f(e);return t==yt||t==bt||t==gt||t==_t}var G=vt;var kt=x["__core-js_shared__"],w=kt;var F=function(){var e=/[^.]+$/.exec(w&&w.keys&&w.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Ct(e){return!!F&&F in e}var q=Ct;var wt=Function.prototype,Ot=wt.toString;function St(e){if(e!=null){try{return Ot.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var $=St;var It=/[\\^$.*+?()[\]{}|]/g,Mt=/^\[object .+?Constructor\]$/,Tt=Function.prototype,Rt=Object.prototype,Et=Tt.toString,At=Rt.hasOwnProperty,Ht=RegExp("^"+Et.call(At).replace(It,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Pt(e){if(!k(e)||q(e))return!1;var t=G(e)?Ht:Mt;return t.test($(e))}var K=Pt;function jt(e,t){return e==null?void 0:e[t]}var Z=jt;function Lt(e,t){var r=Z(e,t);return K(r)?r:void 0}var O=Lt;function Nt(e,t){return e===t||e!==e&&t!==t}var J=Nt;var Dt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Wt=/^\w*$/;function zt(e,t){if(n(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||c(e)?!0:Wt.test(e)||!Dt.test(e)||t!=null&&e in Object(t)}var V=zt;var Ut=O(Object,"create"),u=Ut;function Bt(){this.__data__=u?u(null):{},this.size=0}var Y=Bt;function Gt(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var X=Gt;var Ft="__lodash_hash_undefined__",qt=Object.prototype,$t=qt.hasOwnProperty;function Kt(e){var t=this.__data__;if(u){var r=t[e];return r===Ft?void 0:r}return $t.call(t,e)?t[e]:void 0}var Q=Kt;var Zt=Object.prototype,Jt=Zt.hasOwnProperty;function Vt(e){var t=this.__data__;return u?t[e]!==void 0:Jt.call(t,e)}var ee=Vt;var Yt="__lodash_hash_undefined__";function Xt(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=u&&t===void 0?Yt:t,this}var te=Xt;function g(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}g.prototype.clear=Y;g.prototype.delete=X;g.prototype.get=Q;g.prototype.has=ee;g.prototype.set=te;var T=g;function Qt(){this.__data__=[],this.size=0}var re=Qt;function er(e,t){for(var r=e.length;r--;)if(J(e[r][0],t))return r;return-1}var l=er;var tr=Array.prototype,rr=tr.splice;function ar(e){var t=this.__data__,r=l(t,e);if(r<0)return!1;var a=t.length-1;return r==a?t.pop():rr.call(t,r,1),--this.size,!0}var ae=ar;function or(e){var t=this.__data__,r=l(t,e);return r<0?void 0:t[r][1]}var oe=or;function sr(e){return l(this.__data__,e)>-1}var se=sr;function fr(e,t){var r=this.__data__,a=l(r,e);return a<0?(++this.size,r.push([e,t])):r[a][1]=t,this}var fe=fr;function y(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}y.prototype.clear=re;y.prototype.delete=ae;y.prototype.get=oe;y.prototype.has=se;y.prototype.set=fe;var ie=y;var ir=O(x,"Map"),ne=ir;function nr(){this.size=0,this.__data__={hash:new T,map:new(ne||ie),string:new T}}var ue=nr;function ur(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var de=ur;function dr(e,t){var r=e.__data__;return de(t)?r[typeof t=="string"?"string":"hash"]:r.map}var p=dr;function lr(e){var t=p(this,e).delete(e);return this.size-=t?1:0,t}var le=lr;function pr(e){return p(this,e).get(e)}var pe=pr;function mr(e){return p(this,e).has(e)}var me=mr;function hr(e,t){var r=p(this,e),a=r.size;return r.set(e,t),this.size+=r.size==a?0:1,this}var he=hr;function b(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}b.prototype.clear=ue;b.prototype.delete=le;b.prototype.get=pe;b.prototype.has=me;b.prototype.set=he;var R=b;var xr="Expected a function";function E(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(xr);var r=function(){var a=arguments,o=t?t.apply(this,a):a[0],s=r.cache;if(s.has(o))return s.get(o);var C=e.apply(this,a);return r.cache=s.set(o,C)||s,C};return r.cache=new(E.Cache||R),r}E.Cache=R;var xe=E;var cr=500;function gr(e){var t=xe(e,function(a){return r.size===cr&&r.clear(),a}),r=t.cache;return t}var ce=gr;var yr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,br=/\\(\\)?/g,_r=ce(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(yr,function(r,a,o,s){t.push(o?s.replace(br,"$1"):a||r)}),t}),ge=_r;function vr(e){return e==null?"":B(e)}var m=vr;function kr(e,t){return n(e)?e:V(e,t)?[e]:ge(m(e))}var ye=kr;var Cr=1/0;function wr(e){if(typeof e=="string"||c(e))return e;var t=e+"";return t=="0"&&1/e==-Cr?"-0":t}var be=wr;function Or(e,t){t=ye(t,e);for(var r=0,a=t.length;e!=null&&r<a;)e=e[be(t[r++])];return r&&r==a?e:void 0}var _e=Or;function Sr(e,t,r){var a=e==null?void 0:_e(e,t);return a===void 0?r:a}var Ir=Sr;function Mr(e,t,r,a){var o=-1,s=e==null?0:e.length;for(a&&s&&(r=e[++o]);++o<s;)r=t(r,e[o],o,e);return r}var ve=Mr;function Tr(e){return function(t){return e==null?void 0:e[t]}}var ke=Tr;var Rr={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Er=ke(Rr),Ce=Er;var Ar=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Hr="\\u0300-\\u036f",Pr="\\ufe20-\\ufe2f",jr="\\u20d0-\\u20ff",Lr=Hr+Pr+jr,Nr="["+Lr+"]",Dr=RegExp(Nr,"g");function Wr(e){return e=m(e),e&&e.replace(Ar,Ce).replace(Dr,"")}var we=Wr;var zr=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function Ur(e){return e.match(zr)||[]}var Oe=Ur;var Br=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function Gr(e){return Br.test(e)}var Se=Gr;var Ee="\\ud800-\\udfff",Fr="\\u0300-\\u036f",qr="\\ufe20-\\ufe2f",$r="\\u20d0-\\u20ff",Kr=Fr+qr+$r,Ae="\\u2700-\\u27bf",He="a-z\\xdf-\\xf6\\xf8-\\xff",Zr="\\xac\\xb1\\xd7\\xf7",Jr="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Vr="\\u2000-\\u206f",Yr=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Pe="A-Z\\xc0-\\xd6\\xd8-\\xde",Xr="\\ufe0e\\ufe0f",je=Zr+Jr+Vr+Yr,Le="['\u2019]",Ie="["+je+"]",Qr="["+Kr+"]",Ne="\\d+",ea="["+Ae+"]",De="["+He+"]",We="[^"+Ee+je+Ne+Ae+He+Pe+"]",ta="\\ud83c[\\udffb-\\udfff]",ra="(?:"+Qr+"|"+ta+")",aa="[^"+Ee+"]",ze="(?:\\ud83c[\\udde6-\\uddff]){2}",Ue="[\\ud800-\\udbff][\\udc00-\\udfff]",_="["+Pe+"]",oa="\\u200d",Me="(?:"+De+"|"+We+")",sa="(?:"+_+"|"+We+")",Te="(?:"+Le+"(?:d|ll|m|re|s|t|ve))?",Re="(?:"+Le+"(?:D|LL|M|RE|S|T|VE))?",Be=ra+"?",Ge="["+Xr+"]?",fa="(?:"+oa+"(?:"+[aa,ze,Ue].join("|")+")"+Ge+Be+")*",ia="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",na="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ua=Ge+Be+fa,da="(?:"+[ea,ze,Ue].join("|")+")"+ua,la=RegExp([_+"?"+De+"+"+Te+"(?="+[Ie,_,"$"].join("|")+")",sa+"+"+Re+"(?="+[Ie,_+Me,"$"].join("|")+")",_+"?"+Me+"+"+Te,_+"+"+Re,na,ia,Ne,da].join("|"),"g");function pa(e){return e.match(la)||[]}var Fe=pa;function ma(e,t,r){return e=m(e),t=r?void 0:t,t===void 0?Se(e)?Fe(e):Oe(e):e.match(t)||[]}var qe=ma;var ha="['\u2019]",xa=RegExp(ha,"g");function ca(e){return function(t){return ve(qe(we(t).replace(xa,"")),e,"")}}var $e=ca;var ga="[object String]";function ya(e){return typeof e=="string"||!n(e)&&d(e)&&f(e)==ga}var ba=ya;var _a="[object Boolean]";function va(e){return e===!0||e===!1||d(e)&&f(e)==_a}var ka=va;var Ca="[object Number]";function wa(e){return typeof e=="number"||d(e)&&f(e)==Ca}var Oa=wa;var Sa=$e(function(e,t,r){return e+(r?" ":"")+t.toLowerCase()}),Ia=Sa;var Ma=0;function Ta(e){var t=++Ma;return m(e)+t}var S=Ta;var Ke=(e,t,r)=>new Promise((a,o)=>{var s=h=>{try{I(r.next(h))}catch(M){o(M)}},C=h=>{try{I(r.throw(h))}catch(M){o(M)}},I=h=>h.done?a(h.value):Promise.resolve(h.value).then(s,C);I((r=r.apply(e,t)).next())}),Ze=class{constructor(e){this._target=e}sendMsg(e){if(!this._target)throw new Error("target window is not found");this._target.postMessage(e,"*")}listenMsg(e){this._eventHandler=e,typeof window!="undefined"&&window.addEventListener("message",e)}destroy(){typeof window!="undefined"&&window.removeEventListener("message",this._eventHandler)}},Je=class{constructor(e,t){e==="host"?this.channelManager=new Ze(t):e==="client"&&(this.channelManager=new Ze(window==null?void 0:window.parent))}static createInstance(e,t){return new Je(e,t)}sendMsg(e){var t;(t=this.channelManager)==null||t.sendMsg(e)}listenMsg(e){var t;(t=this.channelManager)==null||t.listenMsg(e)}destroy(){var e;(e=this.channelManager)==null||e.destroy()}},Ve=class{constructor(e){if(this.hostOrigin=e,this.resultMap=new Map,this._msgChannel=null,this._eventMap=new Map,this._handshakeRetryTimes=0,this._handshakeStatus=0,this._prefixId="",this.allowedHostOrigin=["*"],this.hostOrigin=e,typeof window=="undefined"||window.parent===window){this._handshakeStatus=2;return}this._msgChannel=Je.createInstance("client"),this.listeningHostMsg(),this.startHandshake()}sendProactiveHandshakeMsg(){var e;(e=this._msgChannel)==null||e.sendMsg({id:S("handshake-"),type:"handshake",payload:{proactive:!0}})}_initHandshake(){this._handshakeRetryTimes=0,clearTimeout(this._handshakeTimeout),this._handshakeStatus=0,this._handshakePromise=new Promise((e,t)=>{this._handshakeResolve=e,setTimeout(()=>this.retryHandshake(t),2e3)})}startHandshake(){this._initHandshake(),this._handshakePromise.then(()=>{this._handshakeStatus=1}).catch(e=>{this._handshakeStatus=2,console.error("client handshake error : ",e)}),this.sendProactiveHandshakeMsg()}retryHandshake(e){this._handshakeStatus===0&&(this._handshakeRetryTimes<5?(this.sendProactiveHandshakeMsg(),this._handshakeRetryTimes++,this._handshakeTimeout=setTimeout(()=>this.retryHandshake(e),2e3+2**this._handshakeRetryTimes)):e("time out"))}updateInvokeId(){this._invokeId=S(`${this._prefixId}-invoke-`)}get allowedAnyOrigin(){return this.allowedHostOrigin.includes("*")}handleChannelMessage(e){let{origin:t,data:r}=e;if(!this.allowedHostOrigin.includes(t)&&!this.allowedAnyOrigin)return;let{type:a}=r;a==="callback"?this.handleHostCallback(r):a==="handshake"?this.handleHandshakeCallback(r):a==="event"&&this.handleEventCallback(r)}handleHostCallback(e){let{id:t,payload:r}=e,a=this.resultMap.get(t);a&&a(r.res)}handleHandshakeCallback(e){let{id:t,payload:r}=e;this._prefixId=r==null?void 0:r.prefixId,this._handshakeResolve(),this.sendMsg2Host({id:t,type:"handshake",payload:{proactive:!1,info:{isHandshakeSuccess:!0}}})}handleEventCallback(e){return Ke(this,null,function*(){var t;yield this._handshakePromise;let{payload:r}=e,{eventName:a,params:o}=r;((t=this._eventMap.get(a))!=null?t:[]).forEach(s=>{s({data:o})})})}listeningHostMsg(){var e;(e=this._msgChannel)==null||e.listenMsg(this.handleChannelMessage.bind(this))}sendMsg2Host(e){var t;(t=this._msgChannel)==null||t.sendMsg(e)}invokeApi(e,t){return Ke(this,null,function*(){return yield this._handshakePromise,this._invokeId||this.updateInvokeId(),this.sendMsg2Host({type:"invoke",id:this._invokeId,payload:{key:e,params:t,prefixId:this._prefixId}}),new Promise(r=>{this.resultMap.set(this._invokeId,r),this.updateInvokeId()})})}subscribeEvent(e,t){var r;let a=(r=this._eventMap.get(e))!=null?r:[];a.push(t),this._eventMap.set(e,a)}unsubscribeEvent(e,t){var r;let a=(r=this._eventMap.get(e))!=null?r:[],o=a.indexOf(t);o!==-1&&a.splice(o,1)}},Ra=(e=>(e.PENDING="pending",e.LOADING="loading",e.LOADED="loaded",e.ERROR="error",e))(Ra||{}),Ea=(e=>(e.IFRAME_LOAD_TIME_OUT="iframe load time out",e.NOT_ALLOWED_URL="not allowed url",e.HANDSHAKE_TIME_OUT="handshake time out",e))(Ea||{});var A=null,Gf=()=>(A||(A=new Ve),A);export{n as a,k as b,Ir as c,ba as d,ka as e,Oa as f,Ia as g,Gf as h};
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
